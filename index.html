<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImpostorWho - ¬øQui√©n es el impostor?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animaciones personalizadas */
        @keyframes bounceRed {
            0%, 100% { transform: scale(1); color: #dc2626; }
            25% { transform: scale(1.3); color: #ef4444; }
            50% { transform: scale(1.1); color: #f87171; }
            75% { transform: scale(1.2); color: #fca5a5; }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: scale(0.8); }
            15% { opacity: 1; transform: scale(1.1); }
            30% { opacity: 1; transform: scale(1); }
            70% { opacity: 1; transform: scale(1); }
            85% { opacity: 1; transform: scale(1.1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        
        @keyframes wordReveal {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
            100% { opacity: 0; transform: scale(0.9); }
        }
        
        @keyframes flashWarning {
            0%, 100% { background-color: transparent; }
            50% { background-color: rgba(239, 68, 68, 0.2); }
        }
        
        .impostor-bounce {
            animation: bounceRed 2s ease-in-out;
        }
        
        .word-fade {
            animation: wordReveal 3s forwards;
        }
        
        .warning-flash {
            animation: flashWarning 0.5s ease-in-out 3;
        }
        
        .hidden-word {
            transition: all 0.5s ease;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDCjW-hV99_kxEhdxJ_9_3R5NfZsW4WAq0",
            authDomain: "descubre-al-impostor.firebaseapp.com",
            databaseURL: "https://descubre-al-impostor-default-rtdb.firebaseio.com",
            projectId: "descubre-al-impostor",
            storageBucket: "descubre-al-impostor.firebasestorage.app",
            messagingSenderId: "178562891534",
            appId: "1:178562891534:web:55a777565884e4d459e15f"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Componente de iconos
        const Icon = ({ type, size = 20 }) => {
            const icons = {
                users: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/></svg>,
                crown: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 12l10-9 10 9M2 12v10h20V12"/></svg>,
                play: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
                home: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>,
                copy: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
                check: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>,
                bot: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="10" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/></svg>,
                vote: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 11l3 3L22 4M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>,
                mic: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3zM19 10v2a7 7 0 0 1-14 0v-2"/></svg>,
                alert: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
                eye: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
                eyeOff: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
            };
            return icons[type] || null;
        };

        // Base de datos de palabras
        const WORDS_DATABASE = {
            animales: ['perro', 'gato', 'elefante', 'le√≥n', 'tigre', 'panda', 'koala', 'delf√≠n', 'ballena', '√°guila'],
            comida: ['pizza', 'hamburguesa', 'sushi', 'tacos', 'pasta', 'helado', 'ensalada', 'sandwich', 'paella', 'ramen'],
            objetos: ['tel√©fono', 'computadora', 'reloj', 'llave', 'libro', 'guitarra', 'pelota', 'silla', 'l√°mpara', 'teclado'],
            lugares: ['playa', 'monta√±a', 'ciudad', 'bosque', 'desierto', 'museo', 'parque', 'restaurante', 'aeropuerto', 'hospital'],
            colores: ['rojo', 'azul', 'verde', 'amarillo', 'morado', 'naranja', 'rosa', 'negro', 'blanco', 'gris'],
            musica: ['guitarra', 'piano', 'bater√≠a', 'viol√≠n', 'trompeta', 'flauta', 'saxof√≥n', 'arpa', 'bajo', 'micr√≥fono'],
            juegos: ['minecraft', 'fortnite', 'valorant', 'league of legends', 'counter strike', 'gta', 'zelda', 'pokemon', 'mario', 'sonic'],
            variada: []
        };
        
        WORDS_DATABASE.variada = Object.values(WORDS_DATABASE).flat();
        
        const CATEGORY_HINTS = {
            animales: 'Animal',
            comida: 'Comida',
            objetos: 'Objeto',
            lugares: 'Lugar',
            colores: 'Color',
            musica: 'M√∫sica/Instrumento',
            juegos: 'Videojuego',
            variada: 'Palabra variada'
        };
        
        const BOT_NAMES = ['Alex', 'Sam', 'Taylor', 'Jordan', 'Riley', 'Casey'];
        
        // Componente principal del juego
        function ImpostorGame() {
            const [screen, setScreen] = useState('home');
            const [roomCode, setRoomCode] = useState('');
            const [playerName, setPlayerName] = useState('');
            const [currentPlayerId, setCurrentPlayerId] = useState(null);
            const [roomData, setRoomData] = useState(null);
            const [copied, setCopied] = useState(false);
            const [showInstructions, setShowInstructions] = useState(false);
            const [clueInput, setClueInput] = useState('');
            const [wordVisible, setWordVisible] = useState(false);
            const [showImpostorWarning, setShowImpostorWarning] = useState(false);
            const [wordRevealed, setWordRevealed] = useState(false);
            const [isImpostor, setIsImpostor] = useState(false);
            
            const wordTimerRef = useRef(null);
            const impostorTimerRef = useRef(null);
            
            const players = Object.values(roomData?.players || {});
            const isHost = roomData?.host === currentPlayerId;
            const gameStarted = roomData?.game?.started;
            const gamePhase = roomData?.game?.phase;
            
            // Efecto para mostrar/ocultar la palabra autom√°ticamente
            useEffect(() => {
                if (gameStarted && gamePhase === 'playing') {
                    // Reiniciar estados cuando empieza el juego
                    setWordVisible(false);
                    setWordRevealed(false);
                    setShowImpostorWarning(false);
                    
                    // Determinar si es impostor
                    const impostorIds = roomData?.game?.impostorIds || [];
                    const playerIsImpostor = impostorIds.includes(currentPlayerId);
                    setIsImpostor(playerIsImpostor);
                    
                    if (!playerIsImpostor) {
                        // Para jugadores normales: mostrar palabra brevemente
                        setWordVisible(true);
                        setWordRevealed(true);
                        
                        // Ocultar despu√©s de 3 segundos (para stream)
                        wordTimerRef.current = setTimeout(() => {
                            setWordVisible(false);
                        }, 3000);
                    } else {
                        // Para impostor: mostrar advertencia
                        setShowImpostorWarning(true);
                        
                        impostorTimerRef.current = setTimeout(() => {
                            setShowImpostorWarning(false);
                        }, 2000);
                    }
                }
                
                return () => {
                    if (wordTimerRef.current) clearTimeout(wordTimerRef.current);
                    if (impostorTimerRef.current) clearTimeout(impostorTimerRef.current);
                };
            }, [gameStarted, gamePhase, currentPlayerId, roomData?.game?.impostorIds]);
            
            // Escuchar cambios en la sala
            useEffect(() => {
                if (roomCode) {
                    const roomRef = database.ref(`rooms/${roomCode}`);
                    roomRef.on('value', (snapshot) => {
                        setRoomData(snapshot.val());
                    });
                    return () => roomRef.off();
                }
            }, [roomCode]);
            
            // L√≥gica para bots
            useEffect(() => {
                if (gameStarted && gamePhase === 'playing') {
                    const currentIndex = roomData?.game?.currentTurnIndex || 0;
                    const currentPlayer = players[currentIndex % players.length];
                    const currentRound = Math.floor(currentIndex / players.length) + 1;
                    
                    if (currentPlayer?.isBot) {
                        const hasResponded = roomData?.game?.responses?.[currentPlayer.id]?.[currentRound];
                        if (!hasResponded) {
                            const botTimeout = setTimeout(() => {
                                const impostorIds = roomData?.game?.impostorIds || [];
                                const isBotImpostor = impostorIds.includes(currentPlayer.id);
                                let clue;
                                
                                if (isBotImpostor) {
                                    const genericClues = {
                                        animales: ['vive', 'se mueve', 'criatura', 'ser', 'respira'],
                                        comida: ['rico', 'se come', 'alimento', 'comestible', 'nutritivo'],
                                        objetos: ['√∫til', 'cosa', 'objeto', 'herramienta', 'material'],
                                        lugares: ['sitio', 'lugar', 'espacio', 'zona', 'ubicaci√≥n'],
                                        colores: ['tono', 'color', 'matiz', 'pigmento', 'tonalidad'],
                                        musica: ['suena', 'm√∫sica', 'melod√≠a', 'instrumento', 'ritmo'],
                                        juegos: ['juego', 'entretenimiento', 'diversi√≥n', 'virtual', 'consola'],
                                        variada: ['algo', 'cosa', 'palabra', 'elemento', 't√©rmino']
                                    };
                                    
                                    const category = roomData?.config?.category;
                                    const clues = genericClues[category] || ['cosa', 'objeto'];
                                    clue = clues[Math.floor(Math.random() * clues.length)];
                                } else {
                                    const word = roomData?.game?.word;
                                    const wordClues = {
                                        perro: ['ladra', 'canino', 'mascota', 'fiel', 'collar'],
                                        gato: ['ma√∫lla', 'felino', 'ronronea', 'independiente', 'bigotes'],
                                        elefante: ['trompa', 'grande', 'memoria', 'gris', 'colmillos'],
                                        le√≥n: ['melena', 'ruge', 'rey', 'felino', 'savana'],
                                        tigre: ['rayas', 'felino', 'naranja', 'asi√°tico', 'cazador'],
                                        pizza: ['italiana', 'queso', 'redonda', 'horno', 'corteza'],
                                        hamburguesa: ['pan', 'carne', 'r√°pida', 'americana', 'ketchup'],
                                        sushi: ['japon√©s', 'arroz', 'pescado', 'crudo', 'alga'],
                                        tacos: ['mexicano', 'tortilla', 'picante', 'carne', 'cilantro'],
                                        pasta: ['italiana', 'fideos', 'hervir', 'salsa', 'harina'],
                                        minecraft: ['bloques', 'construir', 'pixelado', 'cavar', 'creeper'],
                                        fortnite: ['batalla', 'construye', 'victoria', 'emotes', 'temporada'],
                                        rojo: ['sangre', 'fuego', 'pasi√≥n', 'tomate', 'rosa'],
                                        azul: ['cielo', 'mar', 'fr√≠o', 'agua', 'tranquilo'],
                                        tel√©fono: ['llama', 'm√≥vil', 'pantalla', 'apps', 'comunicaci√≥n'],
                                        computadora: ['teclado', 'pantalla', 'tecnolog√≠a', 'programa', 'datos']
                                    };
                                    
                                    clue = wordClues[word] ? 
                                        wordClues[word][Math.floor(Math.random() * wordClues[word].length)] : 
                                        word?.charAt(0) + '...';
                                }
                                
                                submitClue(clue);
                            }, 2000);
                            
                            return () => clearTimeout(botTimeout);
                        }
                    }
                }
                
                if (gamePhase === 'voting') {
                    const votes = roomData?.game?.votes || {};
                    const botPlayers = players.filter(p => p.isBot && !votes[p.id]);
                    
                    if (botPlayers.length > 0) {
                        const voteTimeout = setTimeout(() => {
                            botPlayers.forEach(bot => {
                                const otherPlayers = players.filter(p => p.id !== bot.id);
                                const randomPlayer = otherPlayers[Math.floor(Math.random() * otherPlayers.length)];
                                database.ref(`rooms/${roomCode}/game/votes/${bot.id}`).set(randomPlayer.id);
                            });
                        }, 2000);
                        
                        return () => clearTimeout(voteTimeout);
                    }
                }
            }, [roomData?.game?.currentTurnIndex, gamePhase, players, roomData?.game?.votes, roomData?.game?.responses]);
            
            // Temporizador para turnos
            useEffect(() => {
                if (gameStarted && gamePhase === 'playing') {
                    const currentIndex = roomData?.game?.currentTurnIndex || 0;
                    const currentPlayer = players[currentIndex % players.length];
                    const currentRound = Math.floor(currentIndex / players.length) + 1;
                    const hasResponded = roomData?.game?.responses?.[currentPlayer?.id]?.[currentRound];
                    
                    if (currentPlayer && !currentPlayer.isBot && !hasResponded) {
                        const startTime = Date.now();
                        const timeLimit = 30000;
                        
                        const timerInterval = setInterval(() => {
                            const elapsed = Date.now() - startTime;
                            const remaining = Math.max(0, Math.ceil((timeLimit - elapsed) / 1000));
                            database.ref(`rooms/${roomCode}/game/timer`).set(remaining);
                            
                            if (remaining === 0) {
                                clearInterval(timerInterval);
                                submitClue('(sin respuesta)');
                            }
                        }, 1000);
                        
                        return () => clearInterval(timerInterval);
                    } else {
                        database.ref(`rooms/${roomCode}/game/timer`).set(null);
                    }
                }
            }, [roomData?.game?.currentTurnIndex, gamePhase, players, roomData?.game?.responses]);
            
            // Funciones principales
            const generateRoomCode = () => {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            };
            
            const createRoom = async () => {
                if (!playerName.trim()) return;
                
                const code = generateRoomCode();
                const playerId = Date.now().toString();
                
                await database.ref(`rooms/${code}`).set({
                    host: playerId,
                    players: {
                        [playerId]: {
                            id: playerId,
                            name: playerName,
                            isHost: true,
                            isBot: false,
                            joinedAt: Date.now()
                        }
                    },
                    config: {
                        category: '',
                        impostorCount: 1
                    },
                    game: {
                        started: false,
                        phase: 'lobby'
                    },
                    createdAt: Date.now()
                });
                
                setRoomCode(code);
                setCurrentPlayerId(playerId);
                setScreen('lobby');
            };
            
            const joinRoom = async () => {
                if (!playerName.trim() || !roomCode.trim()) return;
                
                try {
                    const snapshot = await database.ref(`rooms/${roomCode}`).once('value');
                    if (!snapshot.val()) {
                        alert('Sala no encontrada');
                        return;
                    }
                    
                    const playerId = Date.now().toString();
                    await database.ref(`rooms/${roomCode}/players/${playerId}`).set({
                        id: playerId,
                        name: playerName,
                        isHost: false,
                        isBot: false,
                        joinedAt: Date.now()
                    });
                    
                    setCurrentPlayerId(playerId);
                    setScreen('lobby');
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            };
            
            const updateConfig = async (updates) => {
                await database.ref(`rooms/${roomCode}/config`).update(updates);
            };
            
            const addBot = async () => {
                const players = roomData?.players || {};
                const usedNames = new Set(Object.values(players).map(p => p.name));
                
                let botName;
                do {
                    botName = BOT_NAMES[Math.floor(Math.random() * BOT_NAMES.length)];
                } while (usedNames.has(`${botName} (Bot)`));
                
                const botId = `bot_${Date.now()}`;
                await database.ref(`rooms/${roomCode}/players/${botId}`).set({
                    id: botId,
                    name: `${botName} (Bot)`,
                    isHost: false,
                    isBot: true,
                    joinedAt: Date.now()
                });
            };
            
            const startGame = async () => {
                const players = Object.values(roomData?.players || {});
                
                if (players.length < 3) {
                    alert('Se necesitan al menos 3 jugadores');
                    return;
                }
                
                const category = roomData?.config?.category;
                if (!category) {
                    alert('Selecciona una categor√≠a');
                    return;
                }
                
                const word = WORDS_DATABASE[category][Math.floor(Math.random() * WORDS_DATABASE[category].length)];
                const shuffled = [...players].sort(() => Math.random() - 0.5);
                const impostorIds = shuffled.slice(0, roomData?.config?.impostorCount || 1).map(p => p.id);
                
                await database.ref(`rooms/${roomCode}/game`).update({
                    started: true,
                    phase: 'playing',
                    word,
                    impostorIds,
                    currentTurnIndex: 0,
                    totalTurns: players.length * 3,
                    responses: {},
                    votes: {},
                    timer: null,
                    startedAt: Date.now()
                });
            };
            
            const submitClue = async (clue) => {
                if (!clue.trim()) return;
                
                const players = Object.values(roomData?.players || {});
                const currentIndex = roomData?.game?.currentTurnIndex || 0;
                const currentPlayer = players[currentIndex % players.length];
                const currentRound = Math.floor(currentIndex / players.length) + 1;
                
                await database.ref(`rooms/${roomCode}/game/responses/${currentPlayer.id}/${currentRound}`).set({
                    round: currentRound,
                    clue,
                    timestamp: Date.now()
                });
                
                const nextIndex = currentIndex + 1;
                if (nextIndex >= (roomData?.game?.totalTurns || 0)) {
                    await database.ref(`rooms/${roomCode}/game`).update({
                        phase: 'voting',
                        currentTurnIndex: nextIndex
                    });
                } else {
                    await database.ref(`rooms/${roomCode}/game`).update({
                        currentTurnIndex: nextIndex
                    });
                }
            };
            
            const submitVote = async (votedPlayerId) => {
                await database.ref(`rooms/${roomCode}/game/votes/${currentPlayerId}`).set(votedPlayerId);
            };
            
            const finishVoting = async () => {
                const votes = roomData?.game?.votes || {};
                const impostorIds = roomData?.game?.impostorIds || [];
                
                const voteCounts = {};
                Object.values(votes).forEach(vote => {
                    voteCounts[vote] = (voteCounts[vote] || 0) + 1;
                });
                
                const mostVoted = Object.entries(voteCounts).sort((a, b) => b[1] - a[1])[0];
                const playersWon = mostVoted && impostorIds.includes(mostVoted[0]);
                
                await database.ref(`rooms/${roomCode}/game`).update({
                    phase: 'finished',
                    winner: playersWon ? 'players' : 'impostors'
                });
            };
            
            const resetGame = async () => {
                setWordVisible(false);
                setShowImpostorWarning(false);
                setWordRevealed(false);
                setIsImpostor(false);
                
                await database.ref(`rooms/${roomCode}/game`).update({
                    started: false,
                    phase: 'lobby',
                    word: null,
                    impostorIds: null,
                    currentTurnIndex: 0,
                    responses: {},
                    votes: {},
                    timer: null,
                    winner: null
                });
            };
            
            const copyRoomCode = () => {
                navigator.clipboard.writeText(roomCode);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };
            
            const goHome = async () => {
                if (roomCode && currentPlayerId) {
                    await database.ref(`rooms/${roomCode}/players/${currentPlayerId}`).remove();
                }
                setScreen('home');
                setRoomCode('');
                setPlayerName('');
                setCurrentPlayerId(null);
                setRoomData(null);
                setWordVisible(false);
                setShowImpostorWarning(false);
                setWordRevealed(false);
                setIsImpostor(false);
            };
            
            // Funci√≥n para mostrar la palabra manualmente (si el streamer quiere)
            const toggleWordVisibility = () => {
                if (isImpostor) return; // Los impostores no tienen palabra que mostrar
                setWordVisible(!wordVisible);
            };
            
            // Pantalla de inicio
            if (screen === 'home') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                            <div className="text-center mb-8">
                                <h1 className="text-4xl font-bold text-gray-800 mb-2">ImpostorWho</h1>
                                <p className="text-gray-600">¬øQui√©n es el impostor?</p>
                            </div>
                            
                            {showInstructions ? (
                                <div className="mb-6 p-4 bg-blue-50 rounded-xl text-sm space-y-2">
                                    <h3 className="font-bold text-blue-900 mb-2">üìã C√≥mo Jugar:</h3>
                                    <p><strong>1.</strong> Un jugador crea una sala y comparte el c√≥digo</p>
                                    <p><strong>2.</strong> Todos se unen con el c√≥digo de sala</p>
                                    <p><strong>3.</strong> El host elige categor√≠a e inicia el juego</p>
                                    <p><strong>4.</strong> <span className="text-red-600 font-semibold">¬°ATENCI√ìN STREAMERS!</span> La palabra se oculta autom√°ticamente</p>
                                    <p><strong>5.</strong> Por turnos dan pistas sobre su palabra</p>
                                    <p><strong>6.</strong> Al final, votan qui√©n es el impostor</p>
                                    <p className="text-red-600 font-semibold mt-3">üéØ Objetivo: Los jugadores deben encontrar al impostor</p>
                                    <button onClick={() => setShowInstructions(false)} className="w-full mt-3 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                                        Entendido
                                    </button>
                                </div>
                            ) : (
                                <button onClick={() => setShowInstructions(true)} className="w-full mb-4 bg-blue-100 text-blue-700 py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-blue-200">
                                    <Icon type="alert" size={18} />
                                    ¬øC√≥mo jugar?
                                </button>
                            )}
                            
                            <input 
                                type="text" 
                                placeholder="Tu nombre" 
                                value={playerName} 
                                onChange={(e) => setPlayerName(e.target.value)}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl mb-4 focus:border-purple-500 focus:outline-none"
                            />
                            
                            <button 
                                onClick={createRoom} 
                                disabled={!playerName.trim()}
                                className="w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 text-white font-semibold py-3 rounded-xl mb-3 transition"
                            >
                                Crear Sala
                            </button>
                            
                            <div className="relative my-6">
                                <div className="absolute inset-0 flex items-center">
                                    <div className="w-full border-t border-gray-300"></div>
                                </div>
                                <div className="relative flex justify-center text-sm">
                                    <span className="px-2 bg-white text-gray-500">o</span>
                                </div>
                            </div>
                            
                            <input 
                                type="text" 
                                placeholder="C√≥digo de sala" 
                                value={roomCode} 
                                onChange={(e) => setRoomCode(e.target.value.toUpperCase())}
                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl mb-4 focus:border-pink-500 focus:outline-none"
                            />
                            
                            <button 
                                onClick={joinRoom} 
                                disabled={!playerName.trim() || !roomCode.trim()}
                                className="w-full bg-pink-500 hover:bg-pink-600 disabled:bg-gray-300 text-white font-semibold py-3 rounded-xl transition"
                            >
                                Unirse a Sala
                            </button>
                        </div>
                    </div>
                );
            }
            
            // Pantalla del lobby
            if (screen === 'lobby' && !gameStarted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-600 via-purple-500 to-pink-500 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-2xl p-8">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-3xl font-bold text-gray-800">Sala de Espera</h2>
                                    <button onClick={goHome} className="p-2 hover:bg-gray-100 rounded-lg transition">
                                        <Icon type="home" size={24} />
                                    </button>
                                </div>
                                
                                <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl p-4 mb-6 flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600">C√≥digo de Sala</p>
                                        <p className="text-2xl font-bold text-purple-600">{roomCode}</p>
                                    </div>
                                    <button onClick={copyRoomCode} className="p-3 bg-white rounded-lg hover:bg-gray-50 transition">
                                        <Icon type={copied ? "check" : "copy"} size={24} />
                                    </button>
                                </div>
                                
                                <div className="bg-blue-50 rounded-xl p-4 mb-6 flex items-center gap-2">
                                    <Icon type="mic" />
                                    <p className="text-sm text-gray-700">
                                        <strong>Tip:</strong> Usa Discord o llamada para hablar mientras juegan!
                                    </p>
                                </div>
                                
                                <div className="mb-6">
                                    <h3 className="text-xl font-semibold mb-3 flex items-center gap-2">
                                        <Icon type="users" />
                                        Jugadores ({players.length}/10)
                                    </h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        {players.map(player => (
                                            <div key={player.id} className="bg-gray-50 rounded-lg p-3 flex items-center gap-2">
                                                {player.isHost && <Icon type="crown" size={16} />}
                                                {player.isBot && <Icon type="bot" size={14} />}
                                                <span className={`font-medium ${player.isBot ? 'text-gray-600' : ''}`}>
                                                    {player.name}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                {isHost && (
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Categor√≠a</label>
                                            <select 
                                                value={roomData?.config?.category || ''} 
                                                onChange={(e) => updateConfig({ category: e.target.value })}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none"
                                            >
                                                <option value="">-- Selecciona --</option>
                                                {Object.keys(WORDS_DATABASE).map(cat => (
                                                    <option key={cat} value={cat}>
                                                        {cat.charAt(0).toUpperCase() + cat.slice(1)}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">
                                                N√∫mero de Impostores: {roomData?.config?.impostorCount || 1}
                                            </label>
                                            <input 
                                                type="range" 
                                                min="1" 
                                                max={Math.min(3, Math.floor(players.length / 2))} 
                                                value={roomData?.config?.impostorCount || 1} 
                                                onChange={(e) => updateConfig({ impostorCount: parseInt(e.target.value) })}
                                                className="w-full"
                                            />
                                        </div>
                                        
                                        <button 
                                            onClick={startGame} 
                                            disabled={players.length < 3 || !roomData?.config?.category}
                                            className="w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-semibold py-3 rounded-xl transition flex items-center justify-center gap-2"
                                        >
                                            <Icon type="play" />
                                            Iniciar Juego
                                        </button>
                                        
                                        <button 
                                            onClick={addBot} 
                                            disabled={players.length >= 10}
                                            className="w-full bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100 text-gray-700 font-semibold py-2 rounded-lg transition flex items-center justify-center gap-2"
                                        >
                                            <Icon type="bot" size={16} />
                                            Agregar Bot
                                        </button>
                                    </div>
                                )}
                                
                                {!isHost && (
                                    <div className="text-center text-gray-600">
                                        Esperando a que el host inicie el juego...
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Pantalla de juego (dando pistas)
            if (gameStarted && gamePhase === 'playing') {
                const currentIndex = roomData?.game?.currentTurnIndex || 0;
                const currentPlayer = players[currentIndex % players.length];
                const isMyTurn = currentPlayer?.id === currentPlayerId;
                const currentRound = Math.floor(currentIndex / players.length) + 1;
                const impostorIds = roomData?.game?.impostorIds || [];
                const playerIsImpostor = isImpostor;
                const myWord = playerIsImpostor ? CATEGORY_HINTS[roomData?.config?.category] : roomData?.game?.word;
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-500 to-pink-500 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-2xl p-8">
                                <div className="flex justify-between items-center mb-6">
                                    <div className="flex items-center gap-4">
                                        <div className="bg-purple-100 rounded-full px-4 py-2">
                                            <span className="font-bold text-purple-600">Ronda {currentRound}/3</span>
                                        </div>
                                        <div className="bg-green-100 rounded-full px-4 py-2">
                                            <span className="font-bold text-green-600">Turno {currentIndex + 1}/{roomData?.game?.totalTurns}</span>
                                        </div>
                                        {!currentPlayer?.isBot && roomData?.game?.timer !== null && (
                                            <div className={`rounded-full px-4 py-2 ${(roomData?.game?.timer || 0) <= 10 ? 'bg-red-100' : 'bg-blue-100'}`}>
                                                <span className={`font-bold ${(roomData?.game?.timer || 0) <= 10 ? 'text-red-600' : 'text-blue-600'}`}>
                                                    ‚è±Ô∏è {roomData?.game?.timer || 0}s
                                                </span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className={`relative rounded-xl p-6 mb-6 transition-all duration-500 ${
                                    playerIsImpostor && showImpostorWarning ? 'warning-flash bg-red-50 border-2 border-red-200' : 
                                    playerIsImpostor ? 'bg-red-50 border-2 border-red-200' :
                                    'bg-gradient-to-r from-yellow-100 to-orange-100'
                                }`}>
                                    <div className="flex justify-between items-start mb-2">
                                        <p className="text-sm text-gray-600">
                                            {playerIsImpostor ? 'Tu rol:' : 'Tu palabra:'}
                                        </p>
                                        
                                        {!playerIsImpostor && wordRevealed && (
                                            <button 
                                                onClick={toggleWordVisibility}
                                                className="p-2 hover:bg-gray-200 rounded-lg transition"
                                                title={wordVisible ? "Ocultar palabra" : "Mostrar palabra"}
                                            >
                                                <Icon type={wordVisible ? "eyeOff" : "eye"} size={18} />
                                            </button>
                                        )}
                                    </div>
                                    
                                    {playerIsImpostor ? (
                                        <div>
                                            {showImpostorWarning ? (
                                                <div className="impostor-bounce">
                                                    <p className="text-3xl font-bold text-red-600">¬°ERES EL IMPOSTOR!</p>
                                                </div>
                                            ) : (
                                                <div>
                                                    <p className="text-3xl font-bold text-orange-600">{myWord}</p>
                                                    <p className="text-sm text-red-600 mt-2">
                                                        ¬°Eres el impostor! No sabes la palabra, solo la categor√≠a.
                                                    </p>
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div className="transition-all duration-500">
                                            {wordVisible ? (
                                                <p className="text-3xl font-bold text-orange-600">{myWord}</p>
                                            ) : (
                                                <div>
                                                    <p className="text-lg text-gray-500 italic mb-2">
                                                        La palabra se ha ocultado para streaming
                                                    </p>
                                                    <div className="flex items-center gap-2">
                                                        <button 
                                                            onClick={toggleWordVisibility}
                                                            className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex items-center gap-2"
                                                        >
                                                            <Icon type="eye" size={16} />
                                                            Ver palabra
                                                        </button>
                                                        <span className="text-sm text-gray-500">
                                                            (Solo t√∫ puedes verla)
                                                        </span>
                                                    </div>
                                                </div>
                                            )}
                                            {wordVisible && (
                                                <p className="text-sm text-gray-500 mt-2">
                                                    ‚ö†Ô∏è Esta palabra se ocultar√° autom√°ticamente para evitar stream sniping
                                                </p>
                                            )}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="bg-blue-50 rounded-xl p-4 mb-6">
                                    <p className="text-center font-semibold text-lg">
                                        Turno de: <span className="text-blue-600">{currentPlayer?.name}</span>
                                    </p>
                                </div>
                                
                                {isMyTurn ? (
                                    <div className="space-y-4">
                                        <input 
                                            type="text" 
                                            value={clueInput} 
                                            onChange={(e) => setClueInput(e.target.value)}
                                            onKeyPress={(e) => {
                                                if (e.key === 'Enter' && clueInput.trim()) {
                                                    submitClue(clueInput);
                                                    setClueInput('');
                                                }
                                            }}
                                            placeholder="Escribe tu pista..."
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none text-lg"
                                        />
                                        <button 
                                            onClick={() => {
                                                submitClue(clueInput);
                                                setClueInput('');
                                            }}
                                            disabled={!clueInput.trim()}
                                            className="w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white font-semibold py-3 rounded-xl transition"
                                        >
                                            Enviar Pista
                                        </button>
                                    </div>
                                ) : (
                                    <div className="text-center text-gray-600 py-6">
                                        Esperando a que {currentPlayer?.name} d√© su pista...
                                    </div>
                                )}
                                
                                <div className="mt-8">
                                    <h3 className="text-xl font-semibold mb-4">Pistas de la ronda {currentRound}:</h3>
                                    <div className="space-y-2">
                                        {players.map(player => {
                                            const roundResponse = roomData?.game?.responses?.[player.id]?.[currentRound];
                                            return (
                                                <div key={player.id} className="flex items-center justify-between bg-gray-50 rounded-lg p-3">
                                                    <span className="font-medium">{player.name}</span>
                                                    <span className="text-gray-600">{roundResponse?.clue || '...'}</span>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Pantalla de votaci√≥n
            if (gamePhase === 'voting') {
                const votes = roomData?.game?.votes || {};
                const hasVoted = votes[currentPlayerId];
                const allVoted = Object.keys(votes).length === players.length;
                
                const voteCount = {};
                Object.values(votes).forEach(votedId => {
                    voteCount[votedId] = (voteCount[votedId] || 0) + 1;
                });
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-orange-600 via-red-500 to-pink-500 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-3xl shadow-2xl p-8">
                                <h2 className="text-3xl font-bold text-center mb-6 flex items-center justify-center gap-2">
                                    <Icon type="vote" size={32} />
                                    Fase de Votaci√≥n
                                </h2>
                                
                                <p className="text-center text-gray-600 mb-6">
                                    ¬°Es hora de votar! ¬øQui√©n crees que es el impostor?
                                </p>
                                
                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    {players.map(player => (
                                        <button 
                                            key={player.id} 
                                            onClick={() => submitVote(player.id)}
                                            disabled={hasVoted || player.id === currentPlayerId}
                                            className={`p-4 rounded-xl font-semibold transition ${
                                                votes[currentPlayerId] === player.id ? 'bg-red-500 text-white' : 
                                                player.id === currentPlayerId ? 'bg-gray-200 text-gray-400' : 
                                                'bg-gray-100 hover:bg-red-100'
                                            }`}
                                        >
                                            <div className="flex items-center justify-between">
                                                <span>{player.name}</span>
                                                <span className="text-sm font-bold ml-2">
                                                    {voteCount[player.id] ? `(${voteCount[player.id]})` : ''}
                                                </span>
                                            </div>
                                            {votes[currentPlayerId] === player.id && (
                                                <span className="text-xs">‚úì Votado</span>
                                            )}
                                        </button>
                                    ))}
                                </div>
                                
                                <div className="bg-blue-50 rounded-xl p-4 mb-6">
                                    <p className="text-center font-medium">
                                        Votos: {Object.keys(votes).length} / {players.length}
                                    </p>
                                </div>
                                
                                {isHost && allVoted && (
                                    <button 
                                        onClick={finishVoting}
                                        className="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-xl transition"
                                    >
                                        Revelar Resultado
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Pantalla de resultados
            if (gamePhase === 'finished') {
                const impostorIds = roomData?.game?.impostorIds || [];
                const winner = roomData?.game?.winner;
                const word = roomData?.game?.word;
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-600 via-blue-500 to-purple-500 flex items-center justify-center p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-2xl w-full">
                            <h2 className="text-4xl font-bold text-center mb-6">
                                {winner === 'players' ? 'üéâ ¬°Ganaron los Jugadores!' : 'üòà ¬°Ganaron los Impostores!'}
                            </h2>
                            
                            <div className="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl p-6 mb-6">
                                <p className="text-lg mb-2">
                                    <strong>La palabra era:</strong> <span className="text-2xl font-bold text-orange-600">{word}</span>
                                </p>
                                <p className="text-lg">
                                    <strong>El/Los impostor(es):</strong>
                                    {impostorIds.map((id, idx) => {
                                        const impostor = players.find(p => p.id === id);
                                        return (
                                            <span key={id} className="text-xl font-semibold text-red-600">
                                                {idx > 0 && ', '} {impostor?.name}
                                            </span>
                                        );
                                    })}
                                </p>
                            </div>
                            
                            <div className="mb-6 max-h-96 overflow-y-auto">
                                <h3 className="text-xl font-semibold mb-3">Historial de pistas:</h3>
                                {players.map(player => {
                                    const responses = roomData?.game?.responses?.[player.id] || {};
                                    const isImpostor = impostorIds.includes(player.id);
                                    
                                    return (
                                        <div key={player.id} className="mb-4 bg-gray-50 rounded-lg p-4">
                                            <p className="font-semibold mb-2 flex items-center gap-2">
                                                {player.name}
                                                {isImpostor && (
                                                    <span className="text-xs bg-red-500 text-white px-2 py-1 rounded">
                                                        IMPOSTOR
                                                    </span>
                                                )}
                                            </p>
                                            <div className="space-y-1">
                                                {Object.entries(responses).map(([round, data]) => (
                                                    <p key={round} className="text-sm text-gray-700">
                                                        Ronda {round}: <span className="font-medium">{data.clue}</span>
                                                    </p>
                                                ))}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {isHost && (
                                <div className="flex gap-3">
                                    <button 
                                        onClick={resetGame}
                                        className="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-xl transition"
                                    >
                                        Nueva Partida
                                    </button>
                                    <button 
                                        onClick={goHome}
                                        className="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 rounded-xl transition"
                                    >
                                        Salir
                                    </button>
                                </div>
                            )}
                            
                            {!isHost && (
                                <div className="text-center text-gray-600">
                                    Esperando a que el host inicie una nueva partida...
                                </div>
                            )}
                        </div>
                    </div>
                );
            }
            
            return null;
        }

        // Renderizar la aplicaci√≥n
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ImpostorGame />);
    </script>
</body>
</html>
